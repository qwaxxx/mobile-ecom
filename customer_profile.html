
<!DOCTYPE html>
<html lang="en">
<head>
  <title>Profile</title>
  <!-- [Meta] -->
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=0, minimal-ui">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="description" content="Mantis is made using Bootstrap 5 design framework. Download the free admin template & use it for your project.">
  <meta name="keywords" content="Mantis, Dashboard UI Kit, Bootstrap 5, Admin Template, Admin Dashboard, CRM, CMS, Bootstrap Admin Template">
  <meta name="author" content="CodedThemes">

  <!-- [Favicon] icon -->
  <link rel="icon" href="asset/images/favicon.svg" type="image/x-icon"> <!-- [Google Font] Family -->
<link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Public+Sans:wght@300;400;500;600;700&display=swap" id="main-font-link">
<!-- [Tabler Icons] https://tablericons.com -->
<link rel="stylesheet" href="asset/fonts/tabler-icons.min.css" >
<!-- [Feather Icons] https://feathericons.com -->
<link rel="stylesheet" href="asset/fonts/feather.css" >
<!-- [Font Awesome Icons] https://fontawesome.com/icons -->
<link rel="stylesheet" href="asset/fonts/fontawesome.css" >
<!-- [Material Icons] https://fonts.google.com/icons -->
<link rel="stylesheet" href="asset/fonts/material.css" >
<!-- [Template CSS Files] -->
<link rel="stylesheet" href="asset/css/style.css" id="main-style-link" >
<link rel="stylesheet" href="asset/css/style-preset.css" >

</head>
<!-- [Head] end -->
<!-- [Body] Start -->

<body data-pc-preset="preset-1" data-pc-direction="ltr" data-pc-theme="light">
  <!-- [ Pre-loader ] start -->
<div class="loader-bg">
  <div class="loader-track">
    <div class="loader-fill"></div>
  </div>
</div>
<!-- [ Pre-loader ] End -->

<!-- [ Sidebar Menu ] start -->
<nav class="pc-sidebar">
  <div class="navbar-wrapper">
    <div class="m-header">
      <a href="" class="b-brand text-primary">
        <h5>E-commerce</h5>
      </a>
    </div>
    <div class="navbar-content">
      <ul class="pc-navbar">
        <li class="pc-item">
          <a href="admin_dashboard.html" class="pc-link">
            <span class="pc-micon"><i class="ti ti-dashboard"></i></span>
            <span class="pc-mtext">Dashboard</span>
          </a>
        </li>

        <li class="pc-item pc-caption">
          <label>Menu</label>
          <i class="ti ti-dashboard"></i>
        </li>
      
        <li class="pc-item">
          <a href="admin_user_list.html" class="pc-link">
            <span class="pc-micon"><i class="ti ti-users"></i></span>
            <span class="pc-mtext">Users</span>
          </a>
        </li>

        <li class="pc-item pc-caption">
          <label>Settings</label>
          <i class="ti ti-news"></i>
        </li>
        <li class="pc-item">
          <a href="admin_profile.html" class="pc-link">
            <span class="pc-micon"><i class="ti ti-user"></i></span>
            <span class="pc-mtext">Profile</span>
          </a>
        </li>
        <li class="pc-item">
          <a href="#" id="logoutBtn" class="pc-link">
            <span class="pc-micon"><i class="ti ti-logout"></i></span>
            <span class="pc-mtext">Logout</span>
          </a>
        </li>

        <!-- <li class="pc-item">
          <a href="" class="pc-link">
            <span class="pc-micon"><i class="ti ti-brand-chrome"></i></span>
            <span class="pc-mtext">Help</span>
          </a>
        </li> -->
      </ul>
      <!-- <div class="card text-center">
        <div class="card-body">
          <img src="../assets/images/img-navbar-card.png" alt="images" class="img-fluid mb-2">
          <h5>Upgrade To Pro</h5>
          <p>To get more features and components</p>
          <a href="https://codedthemes.com/item/berry-bootstrap-5-admin-template/" target="_blank"
          class="btn btn-success">Buy Now</a>
        </div>
      </div> -->
    </div>
  </div>
</nav>
<!-- [ Sidebar Menu ] end --> <!-- [ Header Topbar ] start -->

<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

<header class="pc-header">
  <div class="header-wrapper"> <!-- [Mobile Media Block] start -->
<div class="me-auto pc-mob-drp">
  <ul class="list-unstyled">
    <!-- ======= Menu collapse Icon ===== -->
    <li class="pc-h-item pc-sidebar-collapse">
      <a href="#" class="pc-head-link ms-0" id="sidebar-hide">
        <i class="ti ti-menu-2"></i>
      </a>
    </li>
    <li class="pc-h-item pc-sidebar-popup">
      <a href="#" class="pc-head-link ms-0" id="mobile-collapse">
        <i class="ti ti-menu-2"></i>
      </a>
    </li>
    <li class="dropdown pc-h-item d-inline-flex d-md-none">
      <a
        class="pc-head-link dropdown-toggle arrow-none m-0"
        data-bs-toggle="dropdown"
        href="#"
        role="button"
        aria-haspopup="false"
        aria-expanded="false"
      >
        <i class="ti ti-search"></i>
      </a>
      <div class="dropdown-menu pc-h-dropdown drp-search">
        <form class="px-3">
          <div class="form-group mb-0 d-flex align-items-center">
            <i data-feather="search"></i>
            <input type="search" class="form-control border-0 shadow-none" placeholder="Search here. . .">
          </div>
        </form>
      </div>
    </li>
    <li class="pc-h-item d-none d-md-inline-flex">
      <form class="header-search">
        <i data-feather="search" class="icon-search"></i>
        <input type="search" class="form-control" placeholder="Search here. . .">
      </form>
    </li>
  </ul>
</div>
<!-- [Mobile Media Block end] -->
<div class="ms-auto">
  <ul class="list-unstyled">
    
  <!-- <li class="dropdown pc-h-item">
          <a class="pc-head-link dropdown-toggle arrow-none me-0" data-bs-toggle="dropdown" href="#" role="button" aria-haspopup="true" aria-expanded="false">
            <i class="ti ti-bell"></i>
            <span>3</span>
          </a>

          <div class="dropdown-menu dropdown-notification dropdown-menu-end pc-h-dropdown">
            <div class="dropdown-header d-flex align-items-center justify-content-between">
              <h5 class="m-0">Notifications</h5>
              <a href="#" class="pc-head-link bg-transparent" onclick="clearNotifications(event)">
                <i class="ti ti-x text-danger"></i>
              </a>
            </div>
            <div class="dropdown-divider"></div>
            <div class="dropdown-header px-0 text-wrap header-notification-scroll position-relative" style="max-height: calc(100vh - 215px); overflow-y: auto;">
              <div class="list-group list-group-flush w-100" id="notificationList">
              </div>
            </div>
            <div class="dropdown-divider"></div>
            <div class="text-center py-2">
              <a href="#" class="link-primary">View all</a>
            </div>
          </div>
        </li> -->
    
    <li class="dropdown pc-h-item header-user-profile">
      <a
        class="pc-head-link dropdown-toggle arrow-none me-0"
        data-bs-toggle="dropdown"
        href="#"
        role="button"
        aria-haspopup="false"
        data-bs-auto-close="outside"
        aria-expanded="false"
      >
        <img id="userProfilePreview_<?php echo uniqid(); ?>" src="https://via.placeholder.com/150" alt="User profile image" class="user-avtar">
        <span id="userProfileName_<?php echo uniqid(); ?>"></span>
      </a>
      <div class="dropdown-menu dropdown-user-profile dropdown-menu-end pc-h-dropdown">
        <div class="tab-content" id="mysrpTabContent">
          <div class="tab-pane fade show active" id="drp-tab-1" role="tabpanel" aria-labelledby="drp-t1" tabindex="0">
            <a href="admin_profile.html" class="dropdown-item">
              <i class="ti ti-user"></i>
              <span>View Profile</span>
            </a>
            <a href="#" id="logoutBtn1" class="dropdown-item">
              <i class="ti ti-power"></i>
              <span>Logout</span>
            </a>
          </div>
        </div>
      </div>
    </li>
  </ul>
</div>
 </div>
</header>
<!-- [ Header ] end -->

<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>


  <!-- [ Main Content ] start -->
  <div class="pc-container">
    
    <div class="container pt-4">

      
<div class="container">

  <form id="profileForm" enctype="multipart/form-data">
        <div class="mb-3">
            <img id="profilePreview" src="https://via.placeholder.com/150" class="rounded-circle mb-3" width="120" height="120">
            <input type="file" name="profile_image" id="profile_image" class="form-control">
        </div>

        <div class="mb-3">
            <label class="form-label">Name</label>
            <input type="text" name="name" class="form-control" required id="name" >
        </div>

        <div class="mb-3">
            <label class="form-label">Email Address</label>
            <input type="email" name="email" class="form-control" required  id="email">
        </div>
        <div class="mb-3">
            <label class="form-label">Contact</label>
            <input type="text" name="contact" class="form-control" required  id="contact">
        </div>

        <div class="mb-3">
            <label class="form-label">New Password <small class="text-muted">(Leave blank to keep current)</small></label>
            <input type="password" name="password" class="form-control">
        </div>

        <button type="submit" class="btn btn-primary">Update Profile</button>
    </form>

</div>


    </div>
  </div>
  <!-- [ Main Content ] end -->

<footer class="pc-footer">
  <div class="footer-wrapper container-fluid">
    <div class="row">
      <div class="col-sm my-1">
        <p class="m-0"> Copyright 2025</p>
      </div>
      <div class="col-auto my-1">
        <ul class="list-inline footer-link mb-0">
          <li class="list-inline-item"><a href="">E-commerce</a></li>
        </ul>
      </div>
    </div>
  </div>
</footer>
  
  <script src="asset/js/plugins/apexcharts.min.js"></script>
  <script src="asset/js/pages/dashboard-default.js"></script>
  <script src="asset/js/plugins/popper.min.js"></script>
  <script src="asset/js/plugins/simplebar.min.js"></script>
  <script src="asset/js/plugins/bootstrap.min.js"></script>
  <script src="asset/js/fonts/custom-font.js"></script>
  <script src="asset/js/pcoded.js"></script>
  <script src="asset/js/plugins/feather.min.js"></script>
  <script>layout_change('light');</script>
  <script>change_box_container('false');</script>
  <script>layout_rtl_change('false');</script>
  <script>preset_change("preset-1");</script>
  <script>font_change("Public-Sans");</script>


  
  <!---------- NEW SCRIPT ----------->

  <script>
    document.addEventListener('DOMContentLoaded', () => {
      const userId = localStorage.getItem('user_id');
      alert( userId);
    });
  </script>

    <script>
    const API_BASE = 'https://orchid-chinchilla-614427.hostingersite.com/markrey/api';
    const userId = localStorage.getItem('user_id');

    if (!userId) {
      Swal.fire('Error', 'User not logged in', 'error');
      // Redirect to login page or handle unauthorized access
    }

    async function loadProfile() {
      try {
        const res = await fetch(`${API_BASE}/admin_get_profile.php?user_id=${userId}`);
        const data = await res.json();
        
        if (data.error) {
          return Swal.fire('Error', data.error, 'error');
        }

        document.getElementById('name').value = data.name;
        document.getElementById('email').value = data.email;
        document.getElementById('contact').value = data.contact;
        document.getElementById('profilePreview').src = data.profile_image ? 
          `${API_BASE}/../img/${data.profile_image}` : 'https://via.placeholder.com/150';
      } catch (error) {
        Swal.fire('Error', 'Failed to load profile', 'error');
        console.error('Error loading profile:', error);
      }
    }

    document.getElementById('profileForm').addEventListener('submit', async (e) => {
      e.preventDefault();
      
      try {
        const form = document.getElementById('profileForm');
        const formData = new FormData(form);
        formData.append('user_id', userId);

        const res = await fetch(`${API_BASE}/admin_update_profile.php`, {
          method: 'POST',
          body: formData
        });

        const result = await res.json();
        
        if (result.success) {
          Swal.fire('Success', result.message, 'success');
          loadProfile();
        } else {
          Swal.fire('Error', result.error || 'Unknown error', 'error');
        }
      } catch (error) {
        Swal.fire('Error', 'Failed to update profile', 'error');
        console.error('Error updating profile:', error);
      }
    });

    // Preview image before upload
    document.getElementById('profile_image').addEventListener('change', function(e) {
      const file = e.target.files[0];
      if (file) {
        const reader = new FileReader();
        reader.onload = function(event) {
          document.getElementById('profilePreview').src = event.target.result;
        };
        reader.readAsDataURL(file);
      }
    });

    loadProfile();
  </script>

  <script>
    (function() {
        // Unique constants for this instance
        const PROFILE_WIDGET_API_BASE = 'https://orchid-chinchilla-614427.hostingersite.com/markrey/api';
        const PROFILE_USER_ID = localStorage.getItem('user_id');
        
        // Get elements with unique IDs
        const profilePreviewEl = document.getElementById('userProfilePreview_<?php echo uniqid(); ?>');
        const profileNameEl = document.getElementById('userProfileName_<?php echo uniqid(); ?>');

        if (!PROFILE_USER_ID) {
            Swal.fire('Error', 'User not logged in', 'error');
            // Redirect to login page or handle unauthorized access
            return;
        }

        async function loadUserProfileWidget() {
            try {
                const res = await fetch(`${PROFILE_WIDGET_API_BASE}/admin_get_profile.php?user_id=${PROFILE_USER_ID}`);
                const data = await res.json();
                
                if (data.error) {
                    return Swal.fire('Error', data.error, 'error');
                }

                profileNameEl.textContent = data.name;
                profilePreviewEl.src = data.profile_image ? 
                    `${PROFILE_WIDGET_API_BASE}/../img/${data.profile_image}` : 'https://via.placeholder.com/150';
            } catch (error) {
                Swal.fire('Error', 'Failed to load profile', 'error');
                console.error('Profile widget error:', error);
            }
        }

        loadUserProfileWidget();
    })();
</script>

<script>
  document.getElementById('logoutBtn1').addEventListener('click', function(e) {
    e.preventDefault();
    Swal.fire({
      title: 'Are you sure?',
      text: "You will be logged out!",
      icon: 'warning',
      showCancelButton: true,
      confirmButtonColor: '#d33',
      cancelButtonColor: '#6c757d',
      confirmButtonText: 'Yes, logout',
      background: '#ffffff',
      color: '#000000'
    }).then((result) => {
      if (result.isConfirmed) {
        localStorage.removeItem('user_id');
        window.location.href = 'login_page.html'; // Your actual logout script
      }
    });
  });

  document.getElementById('logoutBtn').addEventListener('click', function(e) {
    e.preventDefault();
    Swal.fire({
      title: 'Are you sure?',
      text: "You will be logged out!",
      icon: 'warning',
      showCancelButton: true,
      confirmButtonColor: '#d33',
      cancelButtonColor: '#6c757d',
      confirmButtonText: 'Yes, logout',
      background: '#ffffff',
      color: '#000000'
    }).then((result) => {
      if (result.isConfirmed) {
        localStorage.removeItem('user_id');
        window.location.href = 'login_page.html'; // Your actual logout script
      }
    });
  });
  
</script>


</body>
</html>